\documentclass[pdftex,12pt,a4paper]{article}

\input{title_bor_utf8_knitr_e}

%\usepackage{showkeys} % показывать метки

%\input{/home/boris/science/tex_general/prob_and_sol_utf8}

\title{Теорема Дуба об остановке мартингала}
\author{Борис Демешев, \url{bdemeshev.github.io/sc401}}
\date{\today}


\newcommand{\indef}[1]{\textbf{#1}}


\numberwithin{equation}{page} % уравнения нумеруются на каждой стр. отдельно


\newtheorem{theorem}[equation]{Теорема} % нумерация сквозная с уравнениями

\theoremstyle{definition} % убирает курсив и что-то еще наверное делает ;)
\newtheorem{mydef}[equation]{Определение}

\theoremstyle{definition}
\newtheorem{example}[equation]{Пример}

\theoremstyle{definition}
\newtheorem*{solution}{Решение}


%\newtheorem{assertion}{Утверждение}
%\newtheorem{lemma}{Лемма}

%\theoremstyle{definition}
%\newtheorem*{proof}{Доказательство}

\theoremstyle{definition}
\newtheorem{problem}{Задача}

\makeindex % команда для создания предметного указателя


\bibliographystyle{plain} % стиль оформления ссылок



\begin{document}

\maketitle

% про теорему о моменте остановки
% сначала в дискретном времени, потом в непрерывном

% идеология: лучше сделать лишний повтор, ибо: 1 --- можно рассказать несколько раз, не опасаясь, что кто-нибудь поймет :), 2 --- появляется большая независимость глав.

% аудитория: студенты-нематематики, хотя и студенты-математики могут найти что-нибудь новое для себя


\section{Теорема Дуба}

%На стиль изложения во многом повлияли источники \cite{stirzaker:prp}, \cite{chang:sp}, \cite{ross:scp}

Пусть $X_{t}$ --- наше благосостояние в справедливой игре в момент времени $t$ или мартингал. Наша стратегия заключается в том, чтобы в нужный момент завершить игру, скажем, после крупного выигрыша. Другими словами, наша стратегия определяется моментом остановки $T$. Этот момент остановки --- случайная величина, так как может зависить от хода игры. Случайной величиной является также и $X_{T}$ --- выигрыш на момент выхода из игры. Вопрос в том, чему равен средний выигрыш на момент прекращения игры, $\E(X_{T})$?

Ответ дает теорема Дуба:
Если не ждать <<слишком>> долго, то каким бы хитрым не был момент остановки ожидаемый выигрыш будет равен начальной сумме, $\E(X_{T})=\E(X_{1})$. 

Сразу приведем пример <<слишком>> долгого ожидания: ждать до выигрыша в один рубль в классическом случайном блуждании. Условие  $\E(X_{T})=\E(X_{1})$ здесь нарушено: выигрыш на момент выхода из игры равен одному рублю (по построению), а стартовая сумма равна нулю. Почему это слишком долгое ожидание? Потому, что в этом случае можно доказать, что $\E(T)=+\infty$. 

Точный смысл понятия <<слишком>> долго можно увидеть в теореме: 

\begin{theorem}

Если $X_{t}$ --- мартингал, $T$ --- момент остановки, и выполнено хотя бы одно из пяти условий: 

\begin{enumerate}
\item Момент $T$ ограничен, то есть существует число $M$, такое что $T<M$. 

\item $\P(T<+\infty)=1$ и процесс $X_{t\wedge T}$ ограничен, то есть существует число $M$, такое что для любого $t$ верно неравенство $|X_{t\wedge T}|<M$. 

\item $\E(T)<+\infty$ и существует число $M$, такое что для любого $t$ верно неравенство $\E(|X_{t+1}-X_{t}||\mathcal{F}_{n})<M$.

\item $\P(T<+\infty)=1$, $\E(|X_{T}|)<\infty$ и $lim_{t\to\infty}\E(X_{t}1_{T>t})=0$.

\item $\P(T<+\infty)=1$ и мартингал $X_{t}$ является равномерно интегрируемым.
\end{enumerate}

То: $\E(X_{T})=\E(X_{1})$.
\end{theorem}

В большинстве случаев первых трех критериев достаточно для практического применения.
Четвертый критерий является следствием любого из первых трех (?).

В пятом критерии используется определение равномерной интегрируемости...
Набор случайных величин является равномерно интегрируемым, если...





Из этих критериев все кроме третьего (может есть какой-то <<предельный>> аналог и третьего? --- я не знаю) работают в непрерывном времени.

Из теоремы Дуба легко вывести тождество Вольда. Wald's identity.
 
Если складывать случайное количество случайных величин (опять же, не <<слишком>> много), то среднее значение суммы равно произведению среднего размера слагаемых на среднее количество слагаемых. Это кажется очевидным, но на самом деле не все так просто, так теорема допускает, что количество слагаемых может зависить от размера слагаемых.

\begin{theorem}
Если $X_{i}$ --- независимые одинаково распределенные случайные величины и $T$ --- случайная величина принимающая целые неотрицательные значения и $\E(T)<\infty$, то $\E(\sum_{i=1}^{T}X_{i})=\E(X_{i})\E(T)$.
\end{theorem}

\begin{proof}
Случаный процесс $M_{t}=\sum_{i=1}^{t}X_{i}-t\cdot \E(X_{i})$ --- мартингал. Применяя к нему теорему Дуба получаем, что $\E(M_{T})=\E(M_{1})$. Здесь $\E(M_{1})=0$, $M_{T}=\sum_{i=1}^{T}X_{i}-T\cdot \E(X_{i}$, поэтому $\E(\sum_{i=1}^{T}X_{i})=\E(X_{i})\E(T)$.
\end{proof}




\section{Примеры}

Между примерами и задачами нет существенного различия. Если легко, то можно взять условие примера и попробовать его решить как задачу. А если тяжело, то можно посмотреть решение задачи. Пожалуй, тексты примеров в каком-то смысле <<классические>>. Иногда используемые для решения мартингалы настолько изящны, что вспоминаются субтитры при показе сложных трюков по телевизору: <<Трюки выполнены профессиональными каскадерами. Не пробуйте повторить их самостоятельно>>. Только здесь нужно пробовать!

% включить доказательство без теоремы Дуба


\begin{example}[Симметричное случайное блуждание]

Улитка начинает свой путь в точке 0 и за каждую минуту равновероятно смещается влево или вправо на один сантиметр\footnote{Скорость виноградной улитки около 4 см в минуту, но у нас улитка попалась ленивая.}. Справа от улитки на расстоянии $a$ находится виноградное дерево, слева на расстоянии $b$ --- шелковица.

Какова вероятность того, что улитка доползет до виноградного дерева раньше? Сколько в среднем времени ей потребуется чтобы доползти до любого из деревьев?
\end{example}

\begin{solution}
Решение с мартингалами: $X_{t}$ --- координата улитки в момент времени $T$ --- мартингал. Пусть $T$ --- момент достижения одной из границ ($a$ или $-b$), тогда $|X_{t\wedge T}|\leq \max\{a,b\}$. Момент времени $T$ можно смажорировать геометрической случайной величиной. Разобьем время на интервалы по $(a+b)$ шагов. Будем засчитывать выход за пределы множества $(-b;a)$ только на границах этих интервалов. Очевидно, что требуемое для выхода время от этого только возрастет. 

За каждый интервал вероятность выхода случайного блуждания за пределы множества $(-b;a)$ выше чем $(1/2)^{a+b}$ (это вероятность того, что случайное блуждание сделает $(a+b)$ шагов вправо). Значит требуемое для выхода количество временных интервалов можно ограничить сверху случайной величиной $M$ с геометрическим распределением и вероятностью успеха равной $p=(1/2)^{a+b}$. Получаем, что $\P(T=\infty)\leq \P(M=\infty)=0$ и $\E(T)\leq (a+b) \E(M)=(a+b) 2^{a+b}$.

Применяя пункт (ii) теоремы Дуба получаем, что $\E(X_{T})=\E(X_{1})$. По условию $\E(X_{1})=0$. Величина $X_{T}$ может принимать только два значения $a$ или $-b$. Пусть значение $a$ принимается с вероятностью $p$. Тогда $pa+(1-p)(-b)=0$ и $p=\frac{b}{a+b}$.

Заметим также, что $M_{t}=X^{2}_{t}-t$ --- также мартингал: $\E(M_{t+1}-M_{t}|\mathcal{F}_{t})=\E(2X_{t}\Delta X_{t+1}+(\Delta X_{t+1})^{2}-1|\mathcal{F}_{t})=2X_{t}\E(\Delta X_{t+1}|\mathcal{F}_{t})+\E((\Delta X_{t+1})^{2})-1=0+1-1=0$. 

Применяя ??? пункт (iii) теоремы Дуба получаем, что $\E(M_{T})=\E(M_{1})$. При этом $\E(M_{1})=0$, а $M_{T}=X_{T}^{2}-T$, значит $\E(X_{T}^{2})=\E(T)$. Величина $X_{T}^{2}$ принимает только два значения: $a^{2}$ и $b^{2}$, значит $\E(T)=a^2\frac{b}{a+b}+b^2\frac{a}{a+b}=ab$.
\end{solution}

\begin{example} Несимметричное случайное блуждание 

Улитка начинает свой путь в точке 0 и за каждую минуту смещается влево или вправо на один сантиметр. Однако влево идти улитке не очень хочется, поэтому вправо она идет с вероятностью $p>1/2$, влево --- с вероятностью $(1-p)$. Справа от улитки на расстоянии $a$ находится виноградное дерево, слева на расстоянии $b$ --- шелковица.

Какова вероятность того, что улитка доползет до виноградного дерева раньше? Сколько в среднем времени ей потребуется чтобы доползти до любого из деревьев?
\end{example}

\begin{solution}
Решение с мартингалами: $X_{t}$ --- координата улитки в момент времени $T$ --- не мартингал, т.к. в улитка склонна смещаться вправо.

Как сварить из немартингала мартингал? Один из стандартных приемов следующий: вместо процесса $X_{t}$ рассмотреть процесс $M_{t}=u^{X_{t}}$, где число $u$ подбирается так, чтобы $M_{t}$ стал мартингалом. Из нескольких возможных $u$ выбирают $u\neq 1$, т.к при $u=1$ процесс $M_{t}$ всегда будет равен 1.

Ищем $u$ в нашем случае. Требуем, чтобы $M_{t}$ был мартингалом: $\E(M_{t+1}|\mathcal{F}_{t})=M_{t}$. Это условие упрощается до $\E(u^{\Delta{X}_{t+1}})=1$ или $p\cdot u^{1}+(1-p)\cdot u^{-1}=1$.
Квадратное уравнение имеет два корня, $u=1$ и $u=\frac{1-p}{p}$, выбираем второй.

Как и в случае симметричного случайного блуждания улитки $\P(T=\infty)=0$, $\E(T)<\infty$ так как время $T$ снова мажорируется геометрической случайной величиной. Также и процесс $M_{t\wedge T}$ ограничен сверху.

Применяя пункт (ii) теоремы Дуба получаем, что $\E(M_{T})=\E(M_{1})$. Величина $M_{T}$ принимает всего два значения: $u^{a}$ и $u^{-b}$, а $\E(M_{1})=1$. Пусть $p$ --- вероятность доползти сначала до точки $a$ (виноградного дерева). Из уравнения $pu^{a}+(1-p)u^{-b}=1$ находим $p=\frac{}{}$.

Чтобы найти $\E(T)$ можно использовать мартингал $Y_{t}=X_{t}-t\cdot \E(\Delta X_{t})$ или, что в принципе то же самое, тождество Вольда. По тождеству Вольда среднее количество слагаемых равно среднему значению суммы делить на средний размер слагаемого: $\E(T)=\frac{\E(Y_{T})}{\E(\Delta X_{t})}=...$ 
\end{solution}

\begin{example} ABRACADABRA \cite{ross:scp}\cite{williams:pwm} 
% Ross, Second course, Williams, probability with martingales

Если одна мартышка печатает наугад буквы на клавиатуре, то она рано или поздно с единичной вероятностью напечатает роман Льва Толстого <<Война и мир>>. Мы поставим вопрос по-другому: сколько нажатий на клавиши в среднем потребуется чтобы напечатать слово <<абракадабра>>? Какова дисперсия требуемого количества нажатий?
\end{example}

\begin{solution}
Решение через мартингалы.  Организуем казино! Перед каждым нажатием в казино приходит
новый игрок с начальным капиталом в 1 рубль. Каждый входящий игрок
действует по одной и той же схеме: ставит все имеющиеся деньги на
очередную букву слова АБРАКАДАБРА (войдя в казино игрок ставит на А, потом на Б, потом на Р и т.д. Если слово кончилось, то игрок покидает казино с выигрышем). Если обезьяна напечатала нужную букву, то игрок получает свою ставку, увеличенную в 33 раза, если нет --- то игрок покидает казино без денег. 

Пусть $X_{t}$ --- суммарное благосостояние всех игроков, начавших игру до нажатия номер $t$. Величина $X_{t}$ естественно раскладывается на благосостояния отдельных игроков пришедших в казино $X_{t}=Y_{1t}+...+Y_{tt}$. Здесь $Y_{it}$ --- это благосостояние $i$-го игрока после нажатия номер $t$. Заметим, что для каждого игрока $Y_{it}$ --- это мартингал, т.к. игра справедливая --- на каждом шаге игрок либо теряет деньги, либо с вероятностью $1/33$ увеличивает свой выигрыш в 33 раза. Так как игроки начинают с одного рубля, то $\E(Y_{it})=1$. Чистый выигрыш игроков к моменту времени $t$, $M_{t}=X_{t}-t$ оказывается мартингалом: $\E(M_{t+1}-M_{t}|\mathcal{F}_{t})=\E(Y_{1,t+1}-Y_{1,t}|\mathcal{F}_{t})+...+\E(Y_{t,t+1}-Y_{t,t}|\mathcal{F}_{t})+\E(Y_{t+1,t+1}-1|\mathcal{F}_{t})=0$.

Заметим, что когда слово <<абракадабра>> напечатано впервые, все игроки кроме трех проиграли по одному рублю. Угадавший <<абракадабра>> имеет $33^{11}$, угадавший <<абра>> имеет $33^{4}$ и угадавший <<а>> имеет $33$ рубля. Значит $M_{T}=33^{11}+33^{4}+33-T$. Также получаем, что $M_{t}1_{T>t}\leq (33^{11}+33^{4}+33)1_{T>t}$.

Время $T$ можно смажорировать с помощью геометрической случайной величины. Можно давать обезьяне чистый лист после каждый 11 нажатий и засчитывать <<абракадабру>>, только если слово напечатано на отдельном листе. Очевидно, что ожидаемое время при этом возрастет. Количество листов $L$ будет иметь геометрическое распределение с $p=\frac{1}{33^{11}}$ и $\E(L)=33^{11}$. Значит $T<11L$ и $\E(T)<\E(11\cdot L)=11\cdot 33^{11}$. 

Для геометрического распределения $\P(L>t)$ стремится к нулю при $t\to\infty$. Значит $\E(M_{t}1_{T>t}\leq (33^{11}+33^{4}+33)\E(1_{T>t})\leq (33^{11}+33^{4}+33) \P(L<t/11)$ стремится к нулю.

Применяя пункт (iv) теоремы Дуба получаем, что $\E(M_{T})=\E(M_{1})$. При этом $\E(M_{T}=(33^{11}+33^{4}+33)-\E(T)$, а $\E(M_{1})=0$, значит $\E(T)=33^{11}+33^{4}+33$.

Про дисперсию. Теперь игроки приходят в наше казино с возрастающими суммами денег: первый с одним рублем, второй --- с двумя и т.д. Снова рассмотрим $X_{t}$, суммарное благосостояние игроков вступивших в игру к моменту времени $t$ и чистый выигрыш этих игроков, $M_{t}=X_{t}-(1+2+...+t)=X_{t}-\frac{t(t+1)}{2}$.

При данном изменении выигравших будет также трое и на момент появляения <<абракадабры>> общий чистый выигрыш составит $M_{T}=(T-10)\cdot 33^{11}+(T-3)\cdot 33^{4}+T\cdot 33-\frac{T(T+1)}{2}$.

Как и раньше $\E(T)<\infty$ и $\E(M_{t}1_{T>t})\to 0$ ...

Применяя пункт (iv) теоремы Дуба получаем, что $\E(M_{T})=\E(M_{1})$. Значит $\E(M_{T})=0$. Из этого уравнения выражается $\E(T^{2})$, а затем и по формуле $\Var(T)=\E(T^{2})-\E(T)^{2}$ находим дисперсию $\Var(T)=(33^{11}+33^{4}+33)^{2}-(11\cdot 33^{11}+4\cdot 33^{4}+ 33)$.
\end{solution}

\begin{example} <<Следующая карта --- дама>> \cite{morters:m}, \cite{winkler:gpdp}

Перед гадалкой колода из 36 карт, хорошо перемешанная. Гадалка
должна предсказать появление дамы. Гадалка открывает
одну за другой карты из колоды и в любой момент может остановиться
и сказать <<Следующая карта будет дамой>>. Если это окажется правдой, то гадалка выиграла. 

Какую вероятность выигрыша дает следующая стратегия: дождаться появления первой дамы и после этого рискнуть и заявить, что следующая карта будет дамой? Какова оптимальная стратегия? Каковы при шансы выиграть при оптимальной стратегии?
\end{example}

\begin{solution}
Решение через мартингалы. Рассмотрим процесс $X_{t}$ --- долю дам в еще неоткрытой части колоды после $t$ открытых карт. После $t$ открытых карт в колоде остается $(36-t)$ карт, из которых $(36-t)X_{t}$ дам. С вероятностью $X_{t}$ (доля дам совпадает с вероятностью открыть даму) количество дам уменьшится на одну.

Считаем $\E(X_{t+1}|\mathcal{F}_{t})=\E(X_{t+1}|X_{t})=\frac{(36-t)X_{t}+X_{t}(-1)}{36-t-1}=X_{t}$.

Значит, $X_{t}$ --- мартингал. Момент остановки $T$ в любом случае ограничен 36 картами, следовательно, требования пунтка (i) теоремы Дуба выполнены и $\E(X_{T})=\E(X_{0})=\frac{4}{36}$ для любой стратегии.

Решение без мартингалов. Шансы гадалки не меняются, если она будет угадывать последнюю карту, а не следующую: информации о последней карте ровно столько, сколько о следующей. А шансы того, что последняя карта будет дамой равны $\frac{4}{36}$.
Значит все стратегии оптимальны и дают выигрыш в $4/36$
\end{solution}

\begin{example} <<И в воздух чепчики бросали...>> % Ross, Second Course in Probability

Приезжающих из армии или от двора встречают $n$ женщин. Они
одновременно подбрасывают вверх $n$ чепчиков. Ловят чепчики
наугад, каждая женщина ловит один чепчик.
Женщины, поймавшие свой чепчик уходят. А женщины,
поймавшие чужой чепчик, снова подбрасывают его вверх.
Подбрасывание чепчиков продолжается до тех пор, пока каждая не
поймает свой чепчик. 

\begin{enumerate}

\item  среднее количество женщин, поймавших свой чепчик при одном подбрасывании

\item среднее количество подбрасываний 
\end{enumerate}
\end{example}

\begin{solution}
Решение с мартингалами. Пусть $N_{1}$ --- количество женщин поймавших чепчики при первом подбрасывании. Величина $N$ легко раскладывается в сумму индикаторов: $N_{1}=X_{1}+...+X_{n}$, где $X_{i}$ --- принимает значение 0 или 1 в зависимости от того, поймала ли $i$-ая женщина свой чепчик. Находим $\E(X_{i})=\P(X_{i}=1)=1/n$ и $\E(N_{1})=n\cdot \frac{1}{n}=1$. Аналогично и для остальных раундов, где участвует меньшее количество женщин.

Значит в каждом раунде в среднем одна женщина ловит свой чепчик. Пусть $Y_{t}=N_{1}+...+N_{t}$ --- суммарное количество женщин поймавших свой чепчик после раунда $t$. Получаем, что $\E(Y_{t})=t$. Случайный процесс $M_{t}=Y_{t}-t$ --- это мартингал, так как $\E(M_{t+1}|\mathcal{F}_{t})=\E(M_{t+1}|M_{t})=\E(M_{t}+N_{t+1}-1|M_{t})=M_{t}$. Разность $M_{t+1}-M_{t}=N_{t+1}-1$ ограничена количеством женщин $n$.

Смажорируем $T$, чтобы увидеть, что $\E(T)<\infty$. Вероятность того, что конкретная женщина поймает свой чепчик равна единице делить на количество женщин, участвующих в раунде, а следовательно не меньше $1/n$. Если вместо подбрасывания чепчиков в каждом раунде одна (любая) женщина будет уходить с вероятностью $1/n$, а с вероятностью $1-1/n$ не будет уходить никто, то ожидаемое количество раундов возрастет (занижена вероятность ухода, возможность ухода нескольких женщин за один раунд исключена). Количество раундов для ухода одной женщины в этом случае будет иметь геометрическое распределение со средним значением $n$ раундов, а ожидаемое общее количество раундов равно $n^{2}$. Следовательно, $\E(T)<n^{2}$.

Применяя пункт (iii) теоремы Дуба получаем, что $\E(M_{T})=\E(M_{1})$. Так как $M_{T}=Y_{T}-T=n-T$ и $\E(M_{1})=\E(N_{1}-1)=0$, получаем, что $\E(T)=n$.
\end{solution}

Ключи и сейфы \cite{aops:keys} % aops:keys

Ballot problem \cite{ross:scp} % Ross, Second




\begin{example} 
РРО против ОРО\cite{li:ma}. % Li, Martingale Approach

Правильную монетку подбрасывают до появления последовательности РРО или ОРО. Сколько подбрасываний в среднем нужно? Какова вероятность того, что подбрасывания закончатся последовательностью РРО?
\end{example}

Решение с мартингалами. ???

Решение без мартингалов. ???



\begin{example}  <<Вампиры-гладиаторы>> \cite{winkler:gpdp} % Winkler, Games people don't play

Две команды вампиров-гладиаторов борются за победу в турнире. В вашей команде 100 вампиров с силами от 1,2,..., 100. В команде противника 59 вампиров с силами 72,73,..., 130. Турнир состоит из последовательных раундов в каждом из которых участвует по одному гладиатору с каждой стороны. Если встретились гладиаторы с силами $a$ и $b$, то первый побеждает с вероятностью $\frac{a}{a+b}$, а второй --- с вероятностью $\frac{b}{a+b}$. Победитель добавляет к свой силе силу побежденного (получает силу $a+b$), а побежденный выбывает из турнира (получает силу $0$). Турнир продолжается до полного выбывания одной из команд.

Вы знаете, что команда противника будет выставлять гладиаторов по следующему принципу: на арену всегда выходит самый слабый из команды.

Какова ваша оптимальная стратегия? Какова вероятность выигрыша при этой стратегии?
\end{example}

\begin{solution}
Решение с мартингалами. Пусть $X_{t}$ --- суммарная сила гладиаторов нашей команды после $t$ боев. Процесс $X_{t}$ --- мартингал: $\E(X_{t+1}-X_{t}|\mathcal{F}_{t})=\frac{a}{a+b}b+\frac{b}{a+b}(-a)=0$.

Момент окончания турнира $T$ ограничен, т.к. за каждый раунд выбывает ровно один гладиатор, то есть $T<100+59$.

Применяя пункт (i) теоремы Дуба получаем, что $\E(X_{T})=\E(X_{0})$. Начальная суммарная сила нашей команды, $X_{0}=50\cdot 101$. В конце турнира суммарная сила $X_{T}$ может принимать два значения: либо 0, если мы проиграли, либо $50\cdot 101+59\cdot 101$. Если $p$ --- вероятность нашей победы, то $(1-p)\cdot 0+p\cdot (109\cdot 101)=50\cdot 101$. Значит $p=\frac{50}{109}$. Причем результат не зависит от используемой стратегии, т.к. она нигде не использовалась при подсчете!
\end{solution}



% Задача. <<Гладиаторы>> --- а может у нее нет мартингального решения?

% Задача. Какую долю от имеющейся ставить на цвет следующей карты? 
% есть ли мартингальное решение




% Задача о втором тузе. \cite{morters:m} --- совмещена с гадалкой
% Second heart problem ---  Morters, Martingales, p. 31

% На столе хорошо перемешанная колода из 36 карт. Карты открывают одну за одной до появления первого туза. Какова вероятность того, что следующая карта будет тузом?

% Решение через мартингалы. Рассмотрим процесс $X_{t}$ --- долю тузов в еще неоткрытой % части колоды после $t$ открытых карт. После $t$ открытых карт в колоде остается % $(36-t)$ карт, из которых $(36-t)X_{t}$ тузов. С вероятностью $X_{t}$ (доля тузов % совпадает с вероятностью открыть туза) количество тузов уменьшится на один.

% Считаем %$\E(X_{t+1}|\mathcal{F}_{t})=\E(X_{t+1}|X_{t})=\frac{(36-t)X_{t}+X_{t}(-1)}{36-t-1}=X_{t}% $ .

% Значит, $X_{t}$ --- мартингал. Оптимальный момент остановки $T$ в любом случае %ограничен 36 картами, следовательно, требования пунтка (i) теоремы Дуба выполнены и $ %\E(X_{T})=\E(X_{0})=\frac{4}{36}$.

% Решение без мартингалов. Шансы открыть туза не меняются, если открывать последнюю  карту, а не следующую: информации о последней карте ровно столько, сколько о следующей. % А шансы того, что последняя карта будет тузом равны $\frac{4}{36}$.






\section{Задачи} 

Ряд задач взят из \cite{stirzaker:prp}, \cite{stirzaker:otep}, \cite{zastawniak:bsp}, \cite{blom:pspt}


\begin{problem}
%Усталость улитки.
%Усталость улитки в момент времени $t$ определяется как $U_{t}=t\cdot S_{t}$ (чем %дальше улитка
% эх плохо --- разный знак у S_{t} --- как бы это обозвать?

Пусть $X_{t}$ --- симметричное случайное блуждание.

Найдите $\E(TS_{T})$,
\end{problem}

\begin{problem}\cite{wilmott:chap} % wilmott:chap

Бабушка изготовила кисель. В банке киселя плавают 10 вишенок. За один день Вовочка выпивает случайное количество киселя равномерно распределенное от нуля до всей банки. Вовочка пьет кисель прямо с вишенками, если они ему попадаются. Чтобы бабушка ничего не заметила каждый день Вовочка доливает в банку воды до полного объема.
Вовочка пьет до тех пор пока в банке не останется 5 вишенок. Пусть $T$ --- количество дней, которые Вовочка будет пить кисель, а $X_{t}$ концентрация киселя в день $t$.

Что больше $\E(T)$ или $\E(log X_{T})$?
\end{problem}

\begin{solution}
равны
\end{solution}




\begin{problem} Вариация на тему дней рождения.

Мы набираем людей по одному в группу до тех пор, пока в группе не будет хотя бы одного совпадающего дня рождения. Пусть $T$ количество людей, которое потребуется набрать. Найдите\footnote{величина $\E(T)$ является <<некрасивой>> в том смысле, что не целая и точное значение имеет громоздкую запись. Оказывается, что $\E(T)\approx 23$, но для в решении данной задачи это не используется} $\E(T^{2})-\E(T)$. 
\end{problem}

\begin{solution}
Решение через мартингалы. Каждый вступающий человек приходит в группу с количеством денег равным количеству людей уже вступивших в группу. Обяжем каждого вступающего человека сыграть с каждым уже вступившим в группу в такую лотерею: входящий ставит на кон 1 рубль, если их дни рождения совпадают, то входящий получает 365 рублей, если нет, то входящий теряет рубль (деньги платит и получает устроитель, существующие члены группы ничего не платят и не получают). Пусть $X_{t}$ --- чистый выигрыш всех участников после вступления в группу $t$ человек. Поскольку каждая лотерея по отдельности справедлива, то $X_{t}$ --- мартингал. 

Момент остановки $T$ ограничен сверху, $T\leq 365$. Применяя пункт (i) теоремы Дуба получаем, что $\E(X_{T})=\E(X_{1})$. При этом $\E(X_{1})=0$, а $X_{T}=365-(1+2+...+(T-1))=365-\frac{T(T-1)}{2}$. И $\E(T^{2}-T)=2\cdot 365$.
\end{solution}

\begin{problem} Улитка отдыхает (симметричное блуждание), \cite{blom:pspt}
% r-in-advance game, Blom, Problems and Spanshots from probability theory

Улитка начинает свой путь в точке 0 и за каждую минуту равновероятно смещается влево или вправо на один сантиметр или отдыхает никуда не перемещаясь. Влево (и вправо) улитка ползет с одинаковой вероятностью $p$, отдыхает --- с вероятностью $(1-2p)$. 

Справа от улитки на расстоянии $a$ находится виноградное дерево, слева на расстоянии $b$ --- шелковица.

Какова вероятность того, что улитка доползет до виноградного дерева раньше? Сколько в среднем времени ей потребуется чтобы доползти до любого из деревьев?
\end{problem}


\begin{problem}  Улитка отдыхает (несимметричное блуждание), \cite{blom:pspt}
% r-in-advance game, Blom, Problems and Spanshots from probability theory

Улитка начинает свой путь в точке 0 и за каждую минуту смещается влево или вправо на один сантиметр или отдыхает никуда не перемещаясь. Влево улитка ползет с вероятностью $p_{l}$, вправо --- с вероятностью $p_{r}$, отдыхает --- с вероятностью $(1-p_{l}-p_{r})$. 

Справа от улитки на расстоянии $a$ находится виноградное дерево, слева на расстоянии $b$ --- шелковица.

Какова вероятность того, что улитка доползет до виноградного дерева раньше? Сколько в среднем времени ей потребуется чтобы доползти до любого из деревьев?
\end{problem}

\begin{problem} 
Задача. Ждем 1 рубль. 

Найдите $\E(T)$
\end{problem}

\begin{problem} Войны Добра и Зла \cite{stirzaker:otep}, 12-13

Изначально воюют один воин Добра и один воин Зла. Каждый день судьба выбирает одного из воюющих наугад и добавляет еще одного воина той же стороны. Никто никогда не погибает, они просто сражаются. Пусть $T$ --- время, когда Судьба впервые добавит война Добра.  Найдите $\E(1/(T+2)) $.
\end{problem}

\begin{solution}
Пусть $ X_{t} $ --- доля войнов Добра в конце дня $ t $.
\end{solution}


\begin{problem} Банковский счет улитки. \cite{stirzaker:prp}, 12.5

Перед отправкой в свой долгий путь улитка положила все свои сбережения (один рубль) в банк. За каждую минуту банк начисляет небольшой процент $r>0$, такой что $0<r<1/cos(\frac{\pi}{a+b})-1$. Какая сумма в среднем будет находится на счету улитки к моменту достижения ей любого из деревьев?
\end{problem}


\begin{problem} Сумма координат улитки. \cite{stirzaker:prp}, 12.7

Каждый раз проходя через точку с координатой $x$ улитка получает $x$ рублей. Каков суммарный заработок улитки?
\end{problem}

% Какова средняя координата? --- считается ли?

\begin{problem}
Задача. Улитка на плоскости.  \cite{stirzaker:otep}, 12-17
\end{problem}





% Задача. Улитка на склоне. (???) --- уже скучновато про улитку



\begin{problem}
Есть неправильная монетка, орел выпадает с вероятностью $p$. Монетку подкидывают до тех пор, пока впервые не выпадет два орла подряд. 
\begin{enumerate}
\item Сколько в среднем потребуется подбрасываний?
\item Сколько в среднем окажется орлов?
\end{enumerate}
\end{problem}

\begin{solution}
Пусть $T$ -- момент остановки, когда впервые выпадает два орла, а $N_{t}$ -- количество орлов в момент $t$. $\E(T)$ находится через марковские цепи, системой линейных уравнений. Пусть $T_{1}$ -- сколько нужно ждать до двух орлов подряд, если мы только что выпал один орел:
\begin{equation}
\begin{cases}
\E(T)=1+p\E(T_{1})+(1-p)\E(T)\\
\E(T_{1})=1+p\cdot 0+(1-p)\E(T)
\end{cases}
\end{equation}
Замечаем, что $M_{t}=N_{t}-pt$ -- мартингал. Условия теоремы Дуба выполнены, поэтому $\E(N_{T})=p\E(T)$.
\end{solution}


%\bibliography{e:/documents/tex_general/opit} 
% название файла с коллекцией названий статей/книг

% источники:
% Ross, Second course in probability
% Stirzaker, Probability and random processes
% Stirzaker, One thousand exercises in probability
% Williams, Probability with martingales
% Morters, Martingales
% Chang, Stochastic processes
% Blom, Problems and snapshots from probability theory
% Li, Martingale Approach to the Study of Occurrence of Sequence Patterns in  Repeated % Experiments
% Winkler, Games people don't play
% Zastawniak, Basic stochastic processes
% упр. 3.12 $(-1)^{\tau}=(-1)^{K}$ без всяких ожиданий!

% Shreve, Stochastic calculus for finance I --- ??? (пока не включен, а что там было?)
% aops, keys
% wilmott, ts_t





%\bibliography{/home/boris/science/tex_general/opit}


%\printindex % печать предметного указателя здесь


\end{document}
